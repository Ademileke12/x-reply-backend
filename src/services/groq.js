import fetch from "node-fetch";
import { env } from "../lib/env.js";

const ENDPOINT = "https://api.groq.com/openai/v1/chat/completions";

const examples = [
  "baki type shii fr bro",
  "gm homie, whatâ€™s happening lmao",
  "i swear ppl acting weird today",
  "bro i just wanna know if u got ur acc back",
  "why would anyone even say that for engagement ðŸ˜­",
  "nah man whatâ€™s wrong with ppl nowadays",
  "good morning, i did the same thing and it still flopped",
  "u should honestly do it for the space airdrop",
  "it literally says \"airdrop soon\", read bro ðŸ˜­",
  "be honest, u actually use prediction markets or nah?",
  "lmao i ainâ€™t falling for that trick again",
  "nah thatâ€™s crazy behavior",
  "bro u serious rn??",
  "no way u typed that out loud",
  "this app got ppl losing their mind",
  "yo fr what happened to your account?",
  "homie u down bad saying that",
  "i feel u bro, been there too",
  "stop the cap, u know what u doing",
  "bruh this timeline cooked",
  "nah iâ€™m confused, explain again",
  "wdym by that ðŸ˜­ðŸ˜­",
  "bro u need sleep",
  "nah u acting unhinged this morning",
  "lmao u funny for real",
  "i swear everyone farming engagement now",
  "bro relax it ainâ€™t that deep",
  "u saying weird stuff again ðŸ˜­",
  "not gonna lie i did the same mistake",
  "ayo what kinda post is this",
  "be honest, u farming points rn",
  "why u talking like an npc today",
  "nah thatâ€™s wild go touch grass",
  "u definitely trolling",
  "man this app draining me",
  "bro iâ€™m crying at this comment ðŸ˜­",
  "this whole situation messy",
  "lmao yâ€™all weird",
  "bro what in the hell",
  "nah u gotta be joking",
  "idk what u smoking but share",
  "i feel attacked ðŸ˜­",
  "u fr rn or playing",
  "bro what timezone u in doing this so early",
  "it ainâ€™t adding up king",
  "homie chill and read again",
  "ayo what is going on today",
  "this tweet made me blink twice",
  "not u saying that publicly ðŸ˜­",
  "bro reset your phone or something",
  "i agree tho but damn",
  "the TL unhinged this morning",
  "why u always in drama bro",
  "thatâ€™s definitely bait",
  "lmao iâ€™m not falling for that",
  "nah thatâ€™s crazy phrasing",
  "bro u ainâ€™t serious",
  "what happened to ur old vibe",
  "u switching up today huh",
  "bro i thought u logged out",
  "ayo chill, ppl watching",
  "this comment got me dead ðŸ˜‚",
  "bro stop lying itâ€™s obvious",
  "nah tell the full story",
  "iâ€™m confused but iâ€™ll agree",
  "u really typed that with confidence",
  "bruh u need some water",
  "this the funniest thing i saw today",
  "this app making ppl insane",
  "yo delete this rn ðŸ˜­",
  "nah u cooked this one",
  "bro u weird for that",
  "not me reading this twice",
  "ayo explain the context",
  "man i love this chaos",
  "why would u admit that publicly",
  "lmfao u a menace",
  "bro relax itâ€™s sunday",
  "now why would u lie like that",
  "this gave me a headache",
  "not gonna lie he kinda right",
  "bro ur tweets always unfiltered",
  "ayo u need supervision",
  "this is peak X behavior",
  "no bc why u say that ðŸ˜­",
  "iâ€™m wheezing bro chill",
  "tell me why u acting brand new",
  "this TL dangerous",
  "nah iâ€™m muting this convo",
  "bro who hurt u",
  "now this is engagement farming 101",
  "what the hell did i just read",
  "bro lock out and touch air",
  "ainâ€™t no way u serious",
  "this is why i love this app",
  "bro u wild for waking up like this",
  "thatâ€™s some bold typing right there",
  "i need context immediately",
  "nah i ainâ€™t reading allat",
  "bro relax before i block u jokingly",
  "bro why you typing like baki just woke upðŸ’€",
  "man I swear everyone is losing their accounts lately",
  "you sure they even tried getting it back?",
  "nah this app got people acting strange today",
  "good morning homie, same thing happened to me",
  "bro do it again, maybe it triggers the bot ðŸ’€",
  "tell them to check the spam folder tf",
  "Iâ€™m convinced support is run by ghosts at this point",
  "nah cuz why you saying it like that ðŸ˜­",
  "what kinda morning is this man",
  "ayo who even started this rumor",
  "homie you stressing over nothing fr",
  "I literally said the same yesterday",
  "nah people wilding for engagement today",
  "Iâ€™m tired of explaining this bro",
  "good morning, that thing never works for me either",
  "man yâ€™all really think everything is airdrop now",
  "it literally says wait patiently, why rushing",
  "bro just ask support, why you asking strangers",
  "you sure itâ€™s not your own device acting up",
  "fam stop lying for RTs, itâ€™s embarrassing",
  "yo why everybody acting confused today ðŸ’€",
  "morning homie, I still haven't recovered mine",
  "bro they ain't giving that back anytime soon",
  "you gotta be patient, they slow as hell",
  "nah the way you phrased it got me confused",
  "people doing anything for impressions bruh",
  "whatâ€™s wrong with yâ€™all today fr",
  "morning bro, I tried it and it failed",
  "how many times you want me to repeat this ðŸ˜­",
  "yâ€™all never read the instructions damn",
  "honestly they playing with everyoneâ€™s time",
  "bro thatâ€™s not even the issue",
  "you should try again later fr",
  "why you always panicking this early",
  "thatâ€™s on you lowkey",
  "the energy is weird today bro",
  "morning dawg, this whole thing broken",
  "you ainâ€™t listening, thatâ€™s the problem",
  "be honest, you didnâ€™t follow the steps right",
  "nah stop blaming others bro",
  "thatâ€™s what happens when you rush",
  "you didn't even check the update notes ðŸ’€",
  "morning, same bs happened to me",
  "your tone killing me bro chill",
  "yâ€™all love drama too much",
  "it ain't that serious fr",
  "people acting like it's the end of the world",
  "did you even try rebooting?",
  "morning bro, yeah it sucks fr",
  "bro read the pinned message please",
  "nah this scenario is comedy",
  "ainâ€™t no way you serious rn",
  "some of yâ€™all too impatient",
  "bro itâ€™s literally written there ðŸ’€",
  "why you dragging this out",
  "they will fix it eventually, relax",
  "yâ€™all stressing me out man",
  "I swear you never follow instructions",
  "morning, yeah I went through that too",
  "people do anything for likes these days",
  "you ainâ€™t gotta lie bro",
  "why say it like that LMAO",
  "nah this app full of unserious ppl",
  "bro calm down, nothing happened",
  "itâ€™s not even that deep",
  "morning, I retried it and it worked",
  "your account probably shadowed",
  "speak properly homieðŸ˜­",
  "bro you confused me and yourself",
  "yâ€™all exaggerate everything",
  "you literally skipped half the steps",
  "morning bro, this whole thing janky",
  "nah people acting childish",
  "bro you didnâ€™t need to add all that",
  "the vibe weird today ngl",
  "yâ€™all need sleep fr",
  "morning, I feel you itâ€™s annoying",
  "bro thatâ€™s not even the point",
  "you tryna start drama for no reason",
  "ainâ€™t nothing wrong, you tripping",
  "bro stop saying anything for engagement",
  "morning homie, hope it fixes soon",
  "the way you ask things concern me",
  "people online losing their minds",
  "bro slow down, you not making sense",
  "morning, you should try again later",
  "you overreacting hard rn",
  "bro this why nobody takes yâ€™all serious",
  "nah this whole thread chaoticðŸ˜…",
  "morning dude, I got the same issue",
  "you definitely skipped something",
  "bro you cooked this whole situation",
  "not everything is airdrop soon lmao",
  "I promise it is not that complicated",
  "morning bro, keep checking it",
  "you really typed that with confidence",
  "some of yâ€™all should not have internet access",
  "bro nobody said thatðŸ’€",
  "idk what is going on but Iâ€™m watching"
];

export async function generateReply({ text, tone }) {
  const apiKey = env("GROQ_API_KEY");
  if (!apiKey) throw new Error("Missing Groq API key");
  const body = {
    model: "groq/compound-mini",
    messages: [
      {
        role: "system",
        content:
          "You are X Reply Helper, a concise but human responder. Write one sentence (<=25 words) in the requested tone, referencing tweet details. Sound like these examples: " +
          examples.join(" | ")
      },
      { role: "user", content: `Tone: ${tone}\nTweet: ${text}` }
    ],
    temperature: 0.6,
    max_tokens: 80
  };
  const response = await fetch(ENDPOINT, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${apiKey}`
    },
    body: JSON.stringify(body)
  });
  const payload = await response.json();
  if (!response.ok) {
    throw new Error(payload.error?.message || "Groq request failed");
  }
  return payload?.choices?.[0]?.message?.content?.trim() || "";
}
